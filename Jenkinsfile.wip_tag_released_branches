// Curl site

@Library('genome') _
def senseislack = new org.klick.SenseiSlack()

DEBUG_LOG = []

node('sensei_build') {

  try {
    DEBUG_LOG << "OK"
    def msg = [ subject: 'hi', body: 'there', channel: 'jenkins-dev-tests' ]
    senseislack.post_success(msg)
  }
  catch(err) {
    def msg = [ subject: 'failed', body: "ERROR: ${err}", channel: 'jenkins-dev-tests' ]
    senseislack.post_failure(msg)
  }
  finally {
    post_debug_log()
  }
}


///////////////////////////////////////

def post_debug_log() {
  def body = DEBUG_LOG.collect { "* ${it} " }.join("\n")
  def msg = [ subject: 'DEBUG_LOG', body: body, channel: 'jenkins-dev-tests' ]
  senseislack.post_success(msg)
}